<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bottom Div</title>
</head>
<style>
    body{
        background-color: #40bfcb;
    }
 .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            height: 40vh;
            width: 30vh;
            text-align: center;
            position: absolute;
            bottom: 0;
            right: 0;
        }
        .input-group {
            margin-bottom: 4%;
        }
        .input-group label {
            display: block;
            margin-bottom: 2%;
        }
        .input-group input {
            width: 100%;
            padding: 2%;
            margin: 2% 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .input-group button, .add-expense-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 70%;
            margin-top: 2%;
        }
        .input-group button:hover, .add-expense-btn:hover {
            background-color: #45a049;
        }
        #chart {
            width: 100%;
            height: 40vh;
            margin-top: 4%;
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 5%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 300px;
            text-align: center;
        }
        .popup input {
            width: 80%;
            padding: 2%;
            margin: 3% 0;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        .add-expense-btn{
            background-color: red;
            width: 10vw;
        }
        .popup button {
            padding: 3% 5%;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 80%;
            margin-top: 2%;
        }
        .popup button:hover {
            background-color: #0056b3;
        }
        .popup .cancel-btn {
            background-color: #dc3545;
            margin-top: 2%;
        }
        .popup .cancel-btn:hover {
            background-color: #c82333;
        }

        /*//////////////////// Linear styles///////////////////////////////*/
       
        .Linearcontainer {
            display: flex;
            flex-direction: column; 
            align-items: center;
            width: 30vw;
            max-width: 800px;
            height: 30vh;
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); 
            position: absolute;
           top: 0;
           right: 0;
        }
        #income , #outcome { padding: 10px; 
            font-size: 16px; 
            border: 1px solid #ccc; 
            border-radius: 5px; width: 
            120px; text-align: center; 
        }
        #setDataLinear , #setStartLinear { 
            padding: 10px 20px; 
            font-size: 16px; 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        button:hover { 
            background-color: #45a049; 
        }
        .chart-container { 
            width: 100%; 
            height: 100%;
            flex-grow: 1; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        #linearChart { 
            
            max-height: 400px; 
        }
        .final-values { 
            margin-top: 10px; 
            font-size: 18px; 
            text-align: center; 
            color: #333; 
        }
        .reset-button { 
            background-color: red; 
            margin-top: 10px;
            padding: 10px 20px; 
            font-size: 16px; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;  
        }
        .reset-button:hover { 
            background-color: darkred; 
            }
            /*//////////////paragraphs//////////////////*/
        #EntireStatement{
           
            position: absolute;
            top: 5.5%;
            left: 0;
            font-size: 90%;
        }
        #CurrentStatement{
            font-size: 90%;
            position: absolute;
            top: 5.5%;
            left: 64%;
        }
        #finalOutcome {
            font-size: 100%;
            font-weight: 900;
            color: #007BFF;
        }
        #finalIncome {
            font-size: 100%;
            font-weight: 900;
            color: green
        }
        /*\\\\\\\\\\\\\\\\\\\\daylyFinancescontainer \\\\\\\\\\\\\\\\\\\\\\*/
     
        .left {
            position: absolute;
            left: 0;
            top: 43%;
            width: 30%;
            border: 2px solid red;
            padding-right: 20px;
            border-right: 1px solid #ccc;
        }
        #hourlyRate{
            position: absolute;
            top: 20%;
            left: 0;
        }
        #addWorkDayButton{
            position: absolute;
            top: 35%;
            left: 0;
        }
        #chartBar {
            width: 50vw;
            height: 30%;
            margin-top: 20px;
        }
        .info {
            position: absolute;
            top: 40%;
            left: 0; 
            
        }
        #ChartBarContainer{
            position: absolute;
            bottom: 0;
            left: 33%;
            width: 50vw;
            height: 50vh;
            background-color: #ccc;
        }
        .day-list {
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .day-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        .earned {
            background-color: #4CAF50;
            color: white;
            padding: 5px;
            border-radius: 4px;
        }
        .spent {
            background-color: #FF9800;
            color: white;
            padding: 5px;
            border-radius: 4px;
        }
        .remaining {
            background-color: #2196F3;
            color: white;
            padding: 5px;
            border-radius: 4px;
        }

        @media (max-width: 480px) {
            .container {
                flex-direction: column;
                padding: 15px;
            }
            h1 {
                font-size: 1.5em;
            }
        }
       
</style>
   
<body>

  <div id="buttons-container"></div>
  <div id="container"></div>
  <button id="setStartLinear" onclick="BOX.linearSetInitialValues()">Set Start</button>
<div class="final-values">
    
    
</div>
  <div class="Linearcontainer">
    <p id="CurrentStatement"><strong>Current Statement:</strong> <span id="finalOutcome">0</span> $</p>
    <p id="EntireStatement"><strong>Actual Statement:</strong> <span id="finalIncome">0</span> $</p>
    <div class="chart-container">
        <canvas id="linearChart"></canvas>
    </div>

</div>



<div class="left">
    <h2 id="title_31">Last 31 Days</h2>
    <div class="day-list" id="dayList"></div>
</div>

        <input type="number" id="hourlyRate" placeholder="Enter your hourly rate">
        
        
        
        <div class="info">
            <span>Earned at work: $<span id="totalEarned">0</span></span>
            <span>Remaining Balance: $<span id="remainingBalance">0</span></span>
        </div>
        <div id="ChartBarContainer">
            <canvas id="chartBar"></canvas>
        </div>
        
    
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
const startingPoint = 500;
let scalePizzaGraph = false;
const nameOfTheMonth = "January";
let monthName = "January";
const POWER = {
    "pizzaGraph": {
        "January": {"expenses": []},
        "February": {"expenses": []},
        "March": {"expenses": []},
        "April": {"expenses": []},
        "May": {"expenses": []},
        "June": {"expenses": []},
        "July": {"expenses": []},
        "August": {"expenses": []}
        ,"September": {"expenses": []},
        "October": {"expenses": []},
        "November": {"expenses": []},
        "December": {"expenses": []}
    },
    "linearGraph": {
        "labels": [],
        "incomeData": [],
        "outcomeData": [],
        "cumulativeIncome": 0,
        "cumulativeOutcome": 0,
    }
}
let budgetData = JSON.parse(localStorage.getItem('POWER')) || POWER;
let selectedExpenseIndex = null;
      // Retrieve stored data from localStorage
      let workData = JSON.parse(localStorage.getItem("workData")) || {
            hourlyRate: 20,  // Default hourly rate if no previous data exists
            workDays: [],
            totalEarned: 0,
            remainingBalance: 0
        };

        // Set the default hourly rate in the input field
        document.getElementById("hourlyRate").value = workData.hourlyRate;
        const tritler = document.getElementById("title_31");
        let total3 = 0;

        workData.workDays.forEach(elem => {
            
            total3 += elem.hoursWorked
    
         });
        tritler.innerText = `Total_hours_${total3}`



        const BOX = {
        linearloadSavedData() {
            
            const savedData = JSON.parse(localStorage.getItem("POWER")) || POWER;
            if (savedData.linearGraph) {
                labels = savedData.linearGraph.labels || [];
                incomeData = savedData.linearGraph.incomeData || [];
                outcomeData = savedData.linearGraph.outcomeData || [];
                cumulativeIncome = savedData.linearGraph.cumulativeIncome || 0;
                cumulativeOutcome = savedData.linearGraph.cumulativeOutcome || 0;
            }
            if (savedData.linearGraph.labels.length === 0) {

               
               
                
            }
        },
        linearSaveData() {
    
          POWER.linearGraph = {labels, incomeData, outcomeData, cumulativeIncome, cumulativeOutcome}

            let power = JSON.parse(localStorage.getItem("POWER"));
            if (power) {
                power.linearGraph = {labels, incomeData, outcomeData, cumulativeIncome, cumulativeOutcome}; 
            } else {
                power = POWER
            }
            


            localStorage.setItem('POWER', JSON.stringify(power));
        },
        linearGetCurrentDate() {
            const date = new Date();
            const day = date.getDate();
            const month = date.getMonth() + 1; // Months are 0-based
            const weekDays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const weekDay = weekDays[date.getDay()];
            return `${day}/${month} ${weekDay}`;
        },
        linearCreateChart() {
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '', data: incomeData, borderColor: 'green', borderWidth: 3, tension: 0.4 },
                        { label: '', data: outcomeData, borderColor: '#007BFF', borderWidth: 3, tension: 0.4 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { x: { ticks: { font: { size: 14 } } }, y: { ticks: { font: { size: 14 }, beginAtZero: true } } }
                }
            });
        },
        linearSetInitialValues() {

            labels = [this.linearGetCurrentDate()];
            incomeData = [startingPoint];
            outcomeData = [startingPoint];
            const power = JSON.parse(localStorage.getItem("POWER")) || POWER;
            const a = power.linearGraph.income;
            const b = power.pizzaGraph[monthName].expenses
            b.length = 0;
            power.linearGraph.cumulativeIncome = startingPoint;
            power.linearGraph.cumulativeOutcome = startingPoint;
            localStorage.setItem("POWER" , JSON.stringify(power));
            cumulativeIncome = startingPoint;
            cumulativeOutcome = startingPoint;
            this.linearUpdateChart();
            this.pizzaUpdateChart();
            
            this.linearSaveData();
            const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`;
        },
        linearUpdateGraph( first , second , third) {
       

            const actuallMoney = (first + second + third) || 0;
            cumulativeIncome += BOX.barAddWorkDay( first , second , third);
            
 

            if (third < 0) {
                cumulativeOutcome += second  
            } else {
                cumulativeOutcome += second + third;  
            }
            
           

            labels.push(BOX.linearGetCurrentDate());
            incomeData.push(cumulativeIncome);
            outcomeData.push(cumulativeOutcome);

            BOX.linearUpdateChart();
            BOX.linearSaveData();
        },
        linearUpdateChart() {
            myChart.data.labels = labels;
            myChart.data.datasets[0].data = incomeData;
            myChart.data.datasets[1].data = outcomeData;
            myChart.update();

            document.getElementById('finalIncome').textContent = cumulativeIncome.toFixed(2);
            document.getElementById('finalOutcome').textContent = cumulativeOutcome.toFixed(2);
        },
        pizzaUpdateChart() {
            const total = budgetData.pizzaGraph[monthName].expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const labels = budgetData.pizzaGraph[monthName].expenses.map(expense => `${expense.category}: $${expense.amount} (${((expense.amount / total) * 100).toFixed(2)}%)`);
            const amounts = budgetData.pizzaGraph[monthName].expenses.map(expense => expense.amount);
            const ctx = document.getElementById('chart').getContext('2d');

            if (window.myChart) window.myChart.destroy();

            window.myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels.length ? labels : ["No expenses yet"],
                    datasets: [{
                        label: 'Expenses',
                        data: amounts.length ? amounts : [1],
                        backgroundColor: ["#FF5733", "#33FF57", "#3357FF", "#FF33A1", "#FFD700" , "#4083cb" , "#cb9340" , "#8ccb40" , "#cb4098" , "#40bfcb"],
                    }]
                },
                options: {
                    responsive: true,
                    onClick: (event, elements) => {
                        if (elements.length) {
                            selectedExpenseIndex = elements[0].index;
                            document.getElementById(`popup_${monthName}`).style.display = 'block';
                        }
                    }
                }
            });
    },
        pizzaCreateElements() {
        const container = document.querySelector('body');
        const divContainer = document.createElement('div');
        divContainer.classList.add('container');
        divContainer.ondblclick = BOX.pizzaScale_theGraph;
        divContainer.id = `container_${monthName}`;
        container.appendChild(divContainer);

        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses;
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount;
        });

        const Expected = document.createElement("div");
        const gg = JSON.parse(localStorage.getItem('POWER')) || POWER;
        Expected.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`;
        Expected.id = "unexpected1";
        document.body.append(Expected);

        const addExpenseBtn = document.createElement('button');
        addExpenseBtn.classList.add('add-expense-btn');
        addExpenseBtn.id = `addExpenseBtn_${monthName}`;
        addExpenseBtn.textContent = monthName;
        addExpenseBtn.onclick = BOX.pizzaOpenAddExpensePopup;
        document.body.appendChild(addExpenseBtn);

        const expensesPopupBtn = document.createElement('button');
        expensesPopupBtn.classList.add('expenses-popup-btn');
        expensesPopupBtn.textContent = "Expenses";
        expensesPopupBtn.onclick = BOX.pizzaOpenExpensesPopup;
        document.body.appendChild(expensesPopupBtn);

        const canvas = document.createElement('canvas');
        canvas.id = 'chart';
        divContainer.appendChild(canvas);

        // Add Expense Popup
        const addExpensePopup = document.createElement('div');
        addExpensePopup.classList.add('popup');
        addExpensePopup.id = `addExpensePopup_${monthName}`;
        divContainer.appendChild(addExpensePopup);

        const addExpenseTitle = document.createElement('h3');
        addExpenseTitle.textContent = 'Add Expense';
        addExpensePopup.appendChild(addExpenseTitle);

        const expenseNameInput = document.createElement('input');
        expenseNameInput.placeholder = 'Expense name';
        expenseNameInput.id = `expenceName_${monthName}`;
        addExpensePopup.appendChild(expenseNameInput);

        const expenseAmountInput = document.createElement('input');
        expenseAmountInput.id = 'expenseAmount';
        expenseAmountInput.id = `expenseAmount_${monthName}`;
        expenseAmountInput.type = 'number';
        expenseAmountInput.placeholder = 'Bank Account changes (0) required';
        addExpensePopup.appendChild(expenseAmountInput);

        // New input fields
        const input1 = document.createElement('input');
        input1.placeholder = 'Income';
        input1.id = "addInput1";
        input1.type = "number";
        addExpensePopup.appendChild(input1);

        const input2 = document.createElement('input');
        input2.placeholder = 'Hours';
        input2.id = "addInput2";
        input2.type = "number";
        addExpensePopup.appendChild(input2);

        const addBtn = document.createElement('button');
        addBtn.textContent = 'Add Expected';
        addBtn.id = `add_${monthName}`;
        addBtn.onclick =BOX.pizzaAddExpense;
        addExpensePopup.appendChild(addBtn);

        const unnBtn = document.createElement('button');
        unnBtn.textContent = 'Add Unexpected';
        unnBtn.id = `add_${monthName}`;
        unnBtn.onclick = BOX.pizzaAddunexpectedExpense;
        addExpensePopup.appendChild(unnBtn);

        const cancelAddBtn = document.createElement('button');
        cancelAddBtn.classList.add('cancel-btn');
        cancelAddBtn.textContent = 'Cancel';
        cancelAddBtn.id = `cancel_${monthName}`;
        cancelAddBtn.onclick = BOX.pizzaCloseAddExpensePopup;
        addExpensePopup.appendChild(cancelAddBtn);

        // New Expenses Popup
        const expensesPopup = document.createElement('div');
        expensesPopup.classList.add('popup');
        expensesPopup.id = `expensesPopup_${monthName}`;
        divContainer.appendChild(expensesPopup);

        const expensesTitle = document.createElement('h3');
        expensesTitle.textContent = 'Expenses List';
        expensesPopup.appendChild(expensesTitle);

        const popup = document.createElement('div');
        popup.classList.add('popup');
        popup.id = `popup_${monthName}`;
        divContainer.appendChild(popup);

        const popupTitle = document.createElement('h3');
        popupTitle.textContent = 'Update Expense';
        popup.appendChild(popupTitle);

        const updateAmountInput = document.createElement('input');
        
        updateAmountInput.id = `updateAmount_${monthName}`;
        updateAmountInput.type = 'number';
        updateAmountInput.placeholder = 'Banck Account Changes';
        popup.appendChild(updateAmountInput);

        // New input fields
        const input1Update = document.createElement('input');
        input1Update.placeholder = 'Income';
        input1Update.id = "updateInput1"
        input1Update.type = "number";
        popup.appendChild(input1Update);

        const input2Update = document.createElement('input');
        input2Update.placeholder = 'Hours';
        input2Update.id = "updateInput2"
        input2Update.type = "number";
        popup.appendChild(input2Update);

        const updateBtn = document.createElement('button');
        updateBtn.textContent = 'Update Expected';
        updateBtn.onclick = BOX.pizzaUpdateExpense;
        updateBtn.id = `updateBtn_${monthName}`;
        popup.appendChild(updateBtn);

        // Add "Unexpected" button to the Update Popup
        const unexpectedBtn = document.createElement('button');
        unexpectedBtn.textContent = 'Update Unexpected';
        unexpectedBtn.onclick = BOX.pizzaUnexpectedFunction;
        popup.appendChild(unexpectedBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.classList.add('cancel-btn');
        deleteBtn.textContent = 'Delete';
        deleteBtn.id = `Delete_${monthName}`;
        deleteBtn.onclick = BOX.pizzaDeleteExpense;
        popup.appendChild(deleteBtn);

        const cancelBtn = document.createElement('button');
        cancelBtn.classList.add('cancel-btn');
        cancelBtn.textContent = 'Cancel';
        cancelBtn.id = `Cancel__${monthName}`;
        cancelBtn.onclick =BOX.pizzaClosePopup;
        popup.appendChild(cancelBtn);
    },
        pizzaScale_theGraph() {
        const a = document.getElementById(`container_${monthName}`);
        if (scalePizzaGraph) {
            a.style.height = "40vh";
            a.style.width = "30vh";
            a.style.right = "0";
            a.style.bottom = "2vh";
            scalePizzaGraph = !scalePizzaGraph;
        } else {
            a.style.height = "100vh";
            a.style.width = "90vh";
            a.style.right = "29%";
            a.style.bottom = "0";
            scalePizzaGraph = !scalePizzaGraph;
        }
    },
        pizzaOpenExpensesPopup() {
        const expensesPopup = document.getElementById(`expensesPopup_${monthName}`);
        expensesPopup.innerHTML = '<h3>Expenses List</h3>';  // Clear previous buttons
        
        const expenses = budgetData.pizzaGraph[monthName].expenses;
        if (expenses.length === 0) {
            expensesPopup.innerHTML += '<p>No expenses yet.</p>';
        } else {
            expenses.forEach((expense, index) => {
                const expenseBtn = document.createElement('button');
                expenseBtn.textContent = expense.category;
                expenseBtn.onclick = () => BOX.pizzaOpenExpenseUpdatePopup(index);
                expensesPopup.appendChild(expenseBtn);
            });
        }
        expensesPopup.style.display = 'block';
    },
        pizzaCloseExpensesPopup() {
        document.getElementById(`expensesPopup_${monthName}`).style.display = 'none';
        },
        pizzaOpenExpenseUpdatePopup(index) {
        selectedExpenseIndex = index;
        const expense = budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex];
        const updateAmountInput = document.getElementById(`updateAmount_${monthName}`);
        updateAmountInput.value = expense.amount; // Set current amount
        
        document.getElementById(`popup_${monthName}`).style.display = 'block';
    },
        pizzaUpdateExpense() {
    const additionalAmount = parseFloat(document.getElementById(`updateAmount_${monthName}`).value) || 0;
    const input1Element = document.getElementById("updateInput1") || 0;
    const input2Element = document.getElementById("updateInput2") || 0;
    
    const input1Value = input1Element.value.trim() === "" ? 0 : parseFloat(input1Element.value);
    const input2Value = input2Element.value.trim() === "" ? 0 : parseFloat(input2Element.value);

    // Log the processed values

    // Now proceed with the expense update logic
    if (!isNaN(additionalAmount) && additionalAmount < 0 && selectedExpenseIndex !== null) {
        // Add the new amount and update the expected amount
        budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].amount += additionalAmount;
        budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].expectedAmount += additionalAmount;
        localStorage.setItem('POWER', JSON.stringify(budgetData));
        BOX.linearUpdateGraph(input2Value , additionalAmount , input1Value );
       

        // You can now do something with input1Value and input2Value if needed:
        // For example, save them to the expense item or perform any other logic here.

        // Update the chart and close the popup
       BOX.pizzaUpdateChart();
       BOX.pizzaClosePopup();
       BOX.pizzaCloseAddExpensePopup()
    } else {
        BOX.linearUpdateGraph(input2Value , additionalAmount , input1Value );
       
        BOX.pizzaClosePopup();
        BOX.pizzaCloseAddExpensePopup()
    }
    const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`;
},
        pizzaDeleteExpense() {
        if (selectedExpenseIndex !== null) {
            budgetData.pizzaGraph[monthName].expenses.splice(selectedExpenseIndex, 1);
            localStorage.setItem('POWER', JSON.stringify(budgetData));
           BOX.pizzaUpdateChart();
           BOX.pizzaClosePopup();
        }
        
    },
        pizzaUnexpectedFunction() {
    const input1Element = document.getElementById("updateInput1") || 0;
    const input2Element = document.getElementById("updateInput2") || 0;

    const input1Value = input1Element.value.trim() === "" ? 0 : parseFloat(input1Element.value);
    const input2Value = input2Element.value.trim() === "" ? 0 : parseFloat(input2Element.value);

    // Log the processed values
    

        const additionalAmount = parseFloat(document.getElementById(`updateAmount_${monthName}`).value) || 0;
        if (!isNaN(additionalAmount) && additionalAmount < 0 && selectedExpenseIndex !== null) {
            budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].amount += additionalAmount;
            budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].unexpectedAmount += additionalAmount;
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            BOX.linearUpdateGraph(input2Value , additionalAmount , input1Value );
           BOX.pizzaUpdateChart();
           BOX.pizzaClosePopup();
           BOX.pizzaCloseAddExpensePopup()
        } else {
            BOX.linearUpdateGraph(input2Value , additionalAmount , input1Value );
            BOX.pizzaUpdateChart();
            BOX.pizzaClosePopup();
            BOX.pizzaCloseAddExpensePopup()
        }
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`;
    },
        pizzaClosePopup() {
        document.getElementById(`popup_${monthName}`).style.display = 'none';
    },
        pizzaOpenAddExpensePopup() {
        document.getElementById(`addExpensePopup_${monthName}`).style.display = 'block';
    },
        pizzaCloseAddExpensePopup() {
        document.getElementById(`addExpensePopup_${monthName}`).style.display = 'none';
    },
        pizzaAddExpense() {
    const input1Element = document.getElementById("addInput1");
    const input2Element = document.getElementById("addInput2");
    const incomeThatRises = input2Element.value || 0;

    const input1Value = input1Element.value.trim() === "" ? 0 : parseFloat(input1Element.value);
    const input2Value = input2Element.value.trim() === "" ? 0 : parseFloat(input2Element.value);

    // Log the processed values

        const name = document.getElementById(`expenceName_${monthName}`).value;
        const amount = parseFloat(document.getElementById(`expenseAmount_${monthName}`).value) || 0;
        if (name && !isNaN(amount) && amount < 0) {
            budgetData.pizzaGraph[monthName].expenses.push({ category: name, amount: amount ,  expectedAmount: amount , unexpectedAmount: 0 });
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            BOX.linearUpdateGraph(input2Value , amount , input1Value )
           BOX.pizzaUpdateChart();;
           BOX.pizzaCloseAddExpensePopup();
        } else {
            BOX.linearUpdateGraph(input2Value , amount , input1Value );
            BOX.pizzaCloseAddExpensePopup();
        }
        
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`;
    },
        pizzaAddunexpectedExpense() {
        const input1Element = document.getElementById("addInput1") || 0;
        const input2Element = document.getElementById("addInput2") || 0;

        const input1Value = input1Element.value.trim() === "" ? 0 : parseFloat(input1Element.value);
        const input2Value = input2Element.value.trim() === "" ? 0 : parseFloat(input2Element.value);

        // Log the processed values
        
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const name = document.getElementById(`expenceName_${monthName}`).value;
        const amount = parseFloat(document.getElementById(`expenseAmount_${monthName}`).value) || 0;
        if (name && !isNaN(amount) && amount < 0) {
            budgetData.pizzaGraph[monthName].expenses.push({ category: name, amount: amount ,  expectedAmount: 0 , unexpectedAmount: amount });
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            BOX.linearUpdateGraph(input2Value , amount , input1Value );
            BOX.pizzaUpdateChart();
           BOX.pizzaCloseAddExpensePopup();
        } else {
            BOX.pizzaUpdateChart();
            BOX.linearUpdateGraph(input2Value , amount , input1Value );
            BOX.pizzaCloseAddExpensePopup();
        }
        
        
       
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`;
    },
        barUpdateDisplay() {
            document.getElementById("totalEarned").innerText = workData.totalEarned.toFixed(2);
            document.getElementById("remainingBalance").innerText = workData.remainingBalance.toFixed(2);
           BOX.barDisplayWorkDays();
           BOX.barUpdateChart();
        },
        barDisplayWorkDays() {
            const dayListElement = document.getElementById("dayList");
            dayListElement.innerHTML = ""; // Clear current list

            // Show only the last 31 days
            const last31Days = workData.workDays.slice(-31);
            last31Days.forEach((workDay) => {
                const dayElement = document.createElement("div");
                dayElement.classList.add("day-item");

               
                const formatDate = (date) => {
                    const day = date.getDate(); // Get day of the month
                    const month = date.getMonth() + 1; // Get month (0-based, so +1)
                    const options = { weekday: 'long' }; 
                    const weekday = date.toLocaleDateString('en-US', options); // Get full weekday name

                    return `${month}/${day}_${weekday}`;
                        };

                        const today = new Date();
                        







                const dayDate = formatDate(today);
                
                dayElement.innerHTML = `
                    <span>${dayDate}</span>
                    <span class="earned">Hours: ${workDay.hoursWorked}</span>
                    <span class="earned">Work $${workDay.earnedAmount.toFixed(2)}</span>
                    <span class="earned">Income $${workDay.income.toFixed(2)}</span>
                    <span class="spent">${workDay.salary}: $${workDay.expenses.toFixed(2)}</span>
                    <span class="remaining">Remaining: $${workDay.remainingBalance.toFixed(2)}</span>
                `;
                dayListElement.appendChild(dayElement);
            });
        },
        barAddWorkDay(hours , expences , theIncome) {
            const hourlyRate = parseFloat(document.getElementById("hourlyRate").value) || 25;
            const hoursWorked =  hours;
            const dailyExpenses =  -expences;
               
         

            // Store the hourly rate in localStorage for future use
            workData.hourlyRate = hourlyRate;

            const earnedAmount = hourlyRate * hoursWorked;
            const remainingBalance = earnedAmount - dailyExpenses;
            const today = new Date();

            const workDay = {
                date: today.toISOString(),
                hoursWorked,
                earnedAmount,
                expenses: dailyExpenses,
                remainingBalance,
                income: 0,
                salary: "Spent"
            };
            workDay.income = theIncome;
            let rrrem = remainingBalance + theIncome;
            workDay.remainingBalance = rrrem;
            // Update workData
            workData.workDays.push(workDay);
            workData.totalEarned += earnedAmount;
            workData.remainingBalance += rrrem ;
            if (expences > 0) {
                alert("Did you really get the salary?")
                rrrem = 0;
                workDay.expenses = -workDay.expenses;
                workDay.salary = "Salary";
            } 
            

            // Save updated data to localStorage
            localStorage.setItem("workData", JSON.stringify(workData));
            

           BOX.barUpdateDisplay();
          
          return rrrem
        },
        barUpdateChart() {
            const labels = workData.workDays.slice(-31).map(workDay => new Date(workDay.date).toLocaleDateString());
            const data = workData.workDays.slice(-31).map(workDay => workDay.remainingBalance);

            const ctx = document.getElementById('chartBar').getContext('2d');


                if (window.chartInstance) {
                window.chartInstance.destroy(); // Destroy previous chart to prevent stacking charts
            }

            window.chartInstance = new Chart(ctx, {
                type: 'bar', // Bar chart
                data: {
                    labels: labels.length ? labels : ["No data yet"],
                    datasets: [{
                        label: 'Remaining Balance Over Time',
                        data: data.length ? data : [0],
                        backgroundColor: "#4CAF50",
                        borderColor: "#4CAF50",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return 'Remaining Balance: $' + tooltipItem.raw.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amount ($)'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        },

}



        BOX.pizzaCreateElements();
        BOX.pizzaUpdateChart();


        const ctx = document.getElementById('linearChart').getContext('2d');
        let labels = [], incomeData = [], outcomeData = [];
        let cumulativeIncome = 0, cumulativeOutcome = 0;
        let myChart;
        BOX.linearloadSavedData();
        BOX.linearCreateChart();
        BOX.linearUpdateChart();


  

// Initialize the display when the page loads
       BOX.barUpdateDisplay();
        
       
    










function monthButtons() {
  const a = [
      'January',
      'February',
      'March',
      'April',
      'May',
      'June',
      'July',
      'August',
      'September',
      'October',
      'November',
      'December',
  ];

}
       

 
    function renderMonthButtons(months) {
        const container = document.getElementById("buttons-container");

        months.forEach(month => {
            const button = document.createElement("button");
            button.innerText = month;

            // Add click event listener to each button
            button.addEventListener("click", function() {
              const a =  document.querySelector('.container');
              const b = document.getElementById("unexpected1");
              const c = document.querySelector('.add-expense-btn')
              const d = document.querySelector('.expenses-popup-btn')
              monthName = month
              b.remove();
              a.remove();
              c.remove();
              d.remove();
              BOX.pizzaCreateElements();
              BOX.pizzaUpdateChart();
            });

            container.appendChild(button);
        });
    }

    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    renderMonthButtons(months);



    </script>
</body>
</html>
