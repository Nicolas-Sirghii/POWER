<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bottom Div</title>
</head>
<style>
 .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            height: 40vh;
            width: 30vh;
            text-align: center;
            position: absolute;
            bottom: 0;
            right: 0;
        }
        .input-group {
            margin-bottom: 4%;
        }
        .input-group label {
            display: block;
            margin-bottom: 2%;
        }
        .input-group input {
            width: 100%;
            padding: 2%;
            margin: 2% 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .input-group button, .add-expense-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 70%;
            margin-top: 2%;
        }
        .input-group button:hover, .add-expense-btn:hover {
            background-color: #45a049;
        }
        #chart {
            width: 100%;
            height: 40vh;
            margin-top: 4%;
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 5%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 300px;
            text-align: center;
        }
        .popup input {
            width: 80%;
            padding: 2%;
            margin: 3% 0;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
        .popup button {
            padding: 3% 5%;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 80%;
            margin-top: 2%;
        }
        .popup button:hover {
            background-color: #0056b3;
        }
        .popup .cancel-btn {
            background-color: #dc3545;
            margin-top: 2%;
        }
        .popup .cancel-btn:hover {
            background-color: #c82333;
        }
</style>
   
<body>

  <div id="buttons-container"></div>
  <div id="container"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

      function mainFunction(the_name) {
    const monthName = the_name;

    const POWER = {
        pizzaGraph: {
            January: { expenses: [] },
            February: { expenses: [] },
            March: { expenses: [] },
            April: { expenses: [] },
            May: { expenses: [] },
            June: { expenses: [] },
            July: { expenses: [] },
            August: { expenses: [] },
            September: { expenses: [] },
            October: { expenses: [] },
            November: { expenses: [] },
            December: { expenses: [] },
        },
        unexpectedExpence: 0,

    };

    let budgetData = JSON.parse(localStorage.getItem('POWER')) || POWER;
    let selectedExpenseIndex = null;

    function updateChart() {
        const total = budgetData.pizzaGraph[monthName].expenses.reduce((sum, expense) => sum + expense.amount, 0);
        const labels = budgetData.pizzaGraph[monthName].expenses.map(expense => `${expense.category}: $${expense.amount} (${((expense.amount / total) * 100).toFixed(2)}%)`);
        const amounts = budgetData.pizzaGraph[monthName].expenses.map(expense => expense.amount);
        const ctx = document.getElementById('chart').getContext('2d');

        if (window.myChart) window.myChart.destroy();

        window.myChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels.length ? labels : ["No expenses yet"],
                datasets: [{
                    label: 'Expenses',
                    data: amounts.length ? amounts : [1],
                    backgroundColor: ["#FF5733", "#33FF57", "#3357FF", "#FF33A1", "#FFD700"],
                }]
            },
            options: {
                responsive: true,
                onClick: (event, elements) => {
                    if (elements.length) {
                        selectedExpenseIndex = elements[0].index;
                        document.getElementById(`popup_${monthName}`).style.display = 'block';
                    }
                }
            }
        });
    }

    let scalePizzaGraph = false;
    function createElements() {
        const container = document.querySelector('body');
        const divContainer = document.createElement('div');
        divContainer.classList.add('container');
        
        divContainer.ondblclick = scale_theGraph;
        divContainer.id = `container_${monthName}`;
        container.appendChild(divContainer);


        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });



        const Expected = document.createElement("div")
        const gg = JSON.parse(localStorage.getItem('POWER')) || POWER;
        Expected.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`;
        Expected.id = "unexpected1"
        document.body.append(Expected)

        const addExpenseBtn = document.createElement('button');
        addExpenseBtn.classList.add('add-expense-btn');
        addExpenseBtn.id = `addExpenseBtn_${monthName}`;
        addExpenseBtn.textContent = monthName;
        addExpenseBtn.onclick = openAddExpensePopup;
        document.body.appendChild(addExpenseBtn);

        // New Button to Open Expenses Popup
        const expensesPopupBtn = document.createElement('button');
        expensesPopupBtn.classList.add('expenses-popup-btn');
        expensesPopupBtn.textContent = "Expenses";
        expensesPopupBtn.onclick = openExpensesPopup;
        document.body.appendChild(expensesPopupBtn);

        const canvas = document.createElement('canvas');
        canvas.id = 'chart';
        divContainer.appendChild(canvas);

        // Add Expense Popup
        const addExpensePopup = document.createElement('div');
        addExpensePopup.classList.add('popup');
        addExpensePopup.id = `addExpensePopup_${monthName}`;
        divContainer.appendChild(addExpensePopup);

        const addExpenseTitle = document.createElement('h3');
        addExpenseTitle.textContent = 'Add Expense';
        addExpensePopup.appendChild(addExpenseTitle);

        const expenseNameInput = document.createElement('input');
        expenseNameInput.placeholder = 'Expense name';
        expenseNameInput.id = `expenceName_${monthName}`;
        addExpensePopup.appendChild(expenseNameInput);

        const expenseAmountInput = document.createElement('input');
        expenseAmountInput.id = 'expenseAmount';
        expenseAmountInput.id = `expenseAmount_${monthName}`;
        expenseAmountInput.type = 'number';
        expenseAmountInput.placeholder = 'Amount';
        addExpensePopup.appendChild(expenseAmountInput);

        const addBtn = document.createElement('button');
        addBtn.textContent = 'Add Expected';
        addBtn.id = `add_${monthName}`;
        addBtn.onclick = addExpense;
        addExpensePopup.appendChild(addBtn);

        const unnBtn = document.createElement('button');
        unnBtn.textContent = 'Add Unexpected';
        unnBtn.id = `add_${monthName}`;
        unnBtn.onclick = addunexpectedExpense;
        addExpensePopup.appendChild(unnBtn);

        const cancelAddBtn = document.createElement('button');
        cancelAddBtn.classList.add('cancel-btn');
        cancelAddBtn.textContent = 'Cancel';
        cancelAddBtn.id = `cancel_${monthName}`;
        cancelAddBtn.onclick = closeAddExpensePopup;
        addExpensePopup.appendChild(cancelAddBtn);

        // New Expenses Popup
        const expensesPopup = document.createElement('div');
        expensesPopup.classList.add('popup');
        expensesPopup.id = `expensesPopup_${monthName}`;
        divContainer.appendChild(expensesPopup);

        const expensesTitle = document.createElement('h3');
        expensesTitle.textContent = 'Expenses List';
        expensesPopup.appendChild(expensesTitle);

        // Add Cancel Button to Expenses Popup
        

        // Update Expense Popup (Already created earlier)
        const popup = document.createElement('div');
        popup.classList.add('popup');
        popup.id = `popup_${monthName}`;
        divContainer.appendChild(popup);

        const popupTitle = document.createElement('h3');
        popupTitle.textContent = 'Update Expense';
        popup.appendChild(popupTitle);

        const updateAmountInput = document.createElement('input');
        updateAmountInput.id = 'updateAmount';
        updateAmountInput.id = `updateAmount_${monthName}`;
        updateAmountInput.type = 'number';
        updateAmountInput.placeholder = 'Enter new amount or additional amount';
        popup.appendChild(updateAmountInput);

        const updateBtn = document.createElement('button');
        updateBtn.textContent = 'Update Expected';
        updateBtn.onclick = updateExpense;
        updateBtn.id = `updateBtn_${monthName}`;
        popup.appendChild(updateBtn);

        // Add "Unexpected" button to the Update Popup
        const unexpectedBtn = document.createElement('button');
        unexpectedBtn.textContent = 'Update Unexpected';
        unexpectedBtn.onclick = unexpectedFunction ;
        popup.appendChild(unexpectedBtn);


        const replaceBtn = document.createElement('button');
        replaceBtn.textContent = 'Replace';
        replaceBtn.onclick = replaceExpense;
        popup.appendChild(replaceBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.classList.add('cancel-btn');
        deleteBtn.textContent = 'Delete';
        deleteBtn.id = `Delete_${monthName}`;
        deleteBtn.onclick = deleteExpense;
        popup.appendChild(deleteBtn);

        

        

        const cancelBtn = document.createElement('button');
        cancelBtn.classList.add('cancel-btn');
        cancelBtn.textContent = 'Cancel';
        cancelBtn.id = `Cancel__${monthName}`;
        cancelBtn.onclick = closePopup;
        popup.appendChild(cancelBtn);
    }
    function scale_theGraph() {
      
      const a = document.getElementById(`container_${monthName}`)
      if (scalePizzaGraph) {
          a.style.height = "40vh"
          a.style.width = "30vh"
          a.style.right = "0"
          a.style.bottom = "2vh"
          scalePizzaGraph = !scalePizzaGraph
      } else {
          a.style.height = "100vh"
          a.style.width = "90vh"
          a.style.right = "29%"
          a.style.bottom = "0"
          scalePizzaGraph = !scalePizzaGraph   
      } 
    }
    // Open Expenses Popup and Add Buttons for Each Expense
    function openExpensesPopup() {
        const expensesPopup = document.getElementById(`expensesPopup_${monthName}`);
        expensesPopup.innerHTML = '<h3>Expenses List</h3>';  // Clear previous buttons
        
        const expenses = budgetData.pizzaGraph[monthName].expenses;
        if (expenses.length === 0) {
            expensesPopup.innerHTML += '<p>No expenses yet.</p>';
        } else {
            expenses.forEach((expense, index) => {
                const expenseBtn = document.createElement('button');
                expenseBtn.textContent = expense.category;
                expenseBtn.onclick = () => openExpenseUpdatePopup(index);
                expensesPopup.appendChild(expenseBtn);
            });
        }
        expensesPopup.style.display = 'block';
    }

    // Close Expenses Popup
    function closeExpensesPopup() {
        document.getElementById(`expensesPopup_${monthName}`).style.display = 'none';
    }

    // Open Update Popup for the chosen expense
    function openExpenseUpdatePopup(index) {
        selectedExpenseIndex = index;
        const expense = budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex];
        const updateAmountInput = document.getElementById(`updateAmount_${monthName}`);
        updateAmountInput.value = expense.amount; // Set current amount
        
        document.getElementById(`popup_${monthName}`).style.display = 'block';
    }

    function updateExpense() {
        const additionalAmount = parseFloat(document.getElementById(`updateAmount_${monthName}`).value);
        if (!isNaN(additionalAmount) && additionalAmount > 0 && selectedExpenseIndex !== null) {
            budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].amount += additionalAmount;
            budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].expectedAmount += additionalAmount;
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            updateChart();
            closePopup();
        } else {
            alert("Please enter a valid amount.");
        }
        clearInputField();
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`
        
    }

    function deleteExpense() {
      console.log(budgetData.pizzaGraph[monthName].totalExpence)
      console.log(budgetData.pizzaGraph[monthName].expectedExpence)
      console.log(budgetData.pizzaGraph[monthName].unexpectedExpence)
      console.log(budgetData.pizzaGraph[monthName].expenses.amount)
        if (selectedExpenseIndex !== null) {
            budgetData.pizzaGraph[monthName].expenses.splice(selectedExpenseIndex, 1);
            
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            updateChart();
            closePopup();
            const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`
        
        }
        clearInputField();
    }

    function replaceExpense() {
        const newAmount = parseFloat(document.getElementById(`updateAmount_${monthName}`).value);
        if (!isNaN(newAmount) && newAmount > 0 && selectedExpenseIndex !== null) {
            budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].amount = newAmount;
            budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].expectedAmount = newAmount;
            budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].unexpectedAmount = 0;
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            updateChart();
            closePopup();
        } else {
            alert("Please enter a valid amount.");
        }
        clearInputField();
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`
        
    }

    // "Unexpected" button functionality
    function unexpectedFunction() {
      const additionalAmount = parseFloat(document.getElementById(`updateAmount_${monthName}`).value);
          
        if (!isNaN(additionalAmount) && additionalAmount > 0 && selectedExpenseIndex !== null) {
          budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].amount += additionalAmount;
          budgetData.pizzaGraph[monthName].expenses[selectedExpenseIndex].unexpectedAmount += additionalAmount;
        
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            updateChart();
            closePopup();
        } else {
            alert("Please enter a valid amount.");
        }
        clearInputField();
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`
        
    }

    function closePopup() {
        document.getElementById(`popup_${monthName}`).style.display = 'none';
    }

    function openAddExpensePopup() {
        document.getElementById(`addExpensePopup_${monthName}`).style.display = 'block';
    }

    function closeAddExpensePopup() {
        document.getElementById(`addExpensePopup_${monthName}`).style.display = 'none';
    }

    function addExpense() {
        const name = document.getElementById(`expenceName_${monthName}`).value;
        const amount = parseFloat(document.getElementById(`expenseAmount_${monthName}`).value);
        if (name && !isNaN(amount) && amount > 0) {
            budgetData.pizzaGraph[monthName].expenses.push({ category: name, amount: amount ,  expectedAmount: amount , unexpectedAmount: 0 });
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            updateChart();
            closeAddExpensePopup();
        } else {
            alert("Please enter a valid name and amount.");
        }
        clearInputField();
        
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`
    }

    function addunexpectedExpense() {
        const name = document.getElementById(`expenceName_${monthName}`).value;
        const amount = parseFloat(document.getElementById(`expenseAmount_${monthName}`).value);
        if (name && !isNaN(amount) && amount > 0) {
            budgetData.pizzaGraph[monthName].expenses.push({ category: name, amount: amount ,  expectedAmount: 0 , unexpectedAmount: amount });
            localStorage.setItem('POWER', JSON.stringify(budgetData));
            updateChart();
            closeAddExpensePopup();
        } else {
            alert("Please enter a valid name and amount.");
        }
        clearInputField();
        const unex = JSON.parse(localStorage.getItem("POWER")) || POWER;
        const totalt = unex.pizzaGraph[monthName].expenses
        let countExpectAmount = 0;
        let countUnexpectAmount = 0;
        let countTotalAmount = 0;
        totalt.forEach(element => {
          countExpectAmount += element.expectedAmount;
          countUnexpectAmount += element.unexpectedAmount;
          countTotalAmount += element.amount
        });
        const UnexParagraph = document.getElementById("unexpected1");
        UnexParagraph.innerText = `Expected ${countExpectAmount} Unexpected ${countUnexpectAmount || 0} Total ${countTotalAmount}`
        
    }

    function clearInputField() {
       
        document.getElementById(`updateAmount_${monthName}`).value = '';
    }

    // Initialize the page by creating the elements dynamically
    createElements();

    // Update the chart initially
    updateChart();
}

function monthButtons() {
  const a = [
      'January',
      'February',
      'March',
      'April',
      'May',
      'June',
      'July',
      'August',
      'September',
      'October',
      'November',
      'December',
  ];

}
       mainFunction("May")

 
    function renderMonthButtons(months) {
        const container = document.getElementById("buttons-container");

        months.forEach(month => {
            const button = document.createElement("button");
            button.innerText = month;

            // Add click event listener to each button
            button.addEventListener("click", function() {
              const a =  document.querySelector('.container');
              const b = document.getElementById("unexpected1");
              const c = document.querySelector('.add-expense-btn')
              const d = document.querySelector('.expenses-popup-btn')
              b.remove();
              a.remove();
              c.remove();
              d.remove();
              mainFunction(month)
            });

            container.appendChild(button);
        });
    }

    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    renderMonthButtons(months);



    </script>
</body>
</html>
